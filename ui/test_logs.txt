
> wisata-dental@0.0.0 test:ct
> playwright test -c playwright-ct.config.ts tests/components/SessionStoragePersistence.spec.tsx --project=chromium


Running 1 test using 1 worker

[1A[2K[1/1] [chromium] Î“Ã‡â•‘ tests\components\SessionStoragePersistence.spec.tsx:131:10 Î“Ã‡â•‘ SessionStorage Persistence Î“Ã‡â•‘ Self-healing: 401 should trigger lazy restoration from sessionStorage
[1A[2K[chromium] Î“Ã‡â•‘ tests\components\SessionStoragePersistence.spec.tsx:131:10 Î“Ã‡â•‘ SessionStorage Persistence Î“Ã‡â•‘ Self-healing: 401 should trigger lazy restoration from sessionStorage
Test Started: Self-healing

[1A[2K[Browser]: Firebase Config Debug: {apiKey: test-..., projectId: test-project, authDomain: test.firebaseapp.com}

[1A[2K[Browser]: LoginScreen: Effect running {initialToken: true}

[1A[2K[Browser]: [LoginScreen] initialToken detected {tokenLength: 13}

[1A[2K[Browser]: [GoogleSheetsService] setAccessToken called {tokenLength: 13, hasServiceAccount: false}

[1A[2K[Browser]: [LoginScreen] No encrypted key found, proceeding to spreadsheet_setup

[1A[2K[Browser]: [LoginScreen] Triggering fetchSpreadsheets {hasSessionKey: false, isKeyRestored: false}

[1A[2K[Browser]: [LoginScreen] fetchSpreadsheets called

[1A[2K[Browser]: [GoogleSheetsService] getAccessToken called {hasToken: true, tokenLength: 13}

[1A[2K[Browser]: [LoginScreen] Token check before listSpreadsheets: {hasToken: true, tokenLength: 13}

[1A[2K[Browser]: [GoogleSheetsService] listSpreadsheets called {hasToken: true, hasServiceAccount: false}

[1A[2K[Browser]: [GoogleSheetsService] getAccessToken called {hasToken: true, tokenLength: 13}

[1A[2K[Browser]: Failed to load resource: the server responded with a status of 401 (Unauthorized)

[1A[2K[Browser]: API returned 401 Unauthorized {url: https://www.googleapis.com/drive/v3/files?q=mimeTyÎ“Ã‡Âªet'%20and%20trashed%3Dfalse&fields=files(id,name), serviceAccountKey: false}

[1A[2K[Browser]: 401 but no service account key available -> Logout

[1A[2K[Browser]: [LoginScreen] Failed to list sheets Error: Unauthorized
    at GoogleSheetsService.fetch (http://localhost:3100/assets/GoogleSheetsService-BZPS7YHh.js:19276:15)
    at async GoogleSheetsService.listSpreadsheets (http://localhost:3100/assets/GoogleSheetsService-BZPS7YHh.js:19517:22)
    at async fetchSpreadsheets (http://localhost:3100/assets/LoginScreen-C4uL76ZS.js:92:22)

[1A[2K  1) [chromium] Î“Ã‡â•‘ tests\components\SessionStoragePersistence.spec.tsx:131:10 Î“Ã‡â•‘ SessionStorage Persistence Î“Ã‡â•‘ Self-healing: 401 should trigger lazy restoration from sessionStorage 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    [1mMatcher error[22m: [31mreceived[39m value must not be null nor undefined

    Received has value: [31mnull[39m

      191 |         // Check if the token in sessionStorage got updated
      192 |         const currentToken = await page.evaluate(() => sessionStorage.getItem('google_access_token'));
    > 193 |         expect(currentToken).toContain('mock_access_token');
          |                              ^
      194 |         expect(currentToken).not.toBe('expired_token');
      195 |     });
      196 | });
        at C:\Users\darren\OneDrive\Documents\project\clinic-app\ui\tests\components\SessionStoragePersistence.spec.tsx:193:30

    Error Context: test-results\components-SessionStorageP-c5eac-oration-from-sessionStorage-chromium\error-context.md


[1A[2K  1 failed
    [chromium] Î“Ã‡â•‘ tests\components\SessionStoragePersistence.spec.tsx:131:10 Î“Ã‡â•‘ SessionStorage Persistence Î“Ã‡â•‘ Self-healing: 401 should trigger lazy restoration from sessionStorage 

[36m  Serving HTML report at http://localhost:9323. Press Ctrl+C to quit.[39m
